# 6장. 도커 볼륨을 이용한 퍼시스턴트 스토리지
## 6.1 컨테이너 속 데이터가 사라지는 이유
* 모든 컨테이너는 독립된 파일 시스템을 갖는다. 
  * 같은 이미지에서 실행한 여러 개의 컨테이너는 처음에는 디스크의 내용이 모두 같다 
  * 그 중 한 컨테이너에서 애플리케이션이 파일을 수정해도 다른 컨테이너나 이미지에 영향을 받지 않는다.
  * 구성 : 이미지 레이어, 기록 가능 레이어, 도커 볼륨, 마운트
* 이미지 레이어
  * 읽기 전용
  * 모든 컨테이너가 공유
  * 이미지를 내려받는 순간부터 삭제할 때까지 로컬 컴퓨터의 이미지 레이어에 존재한다. 
* 기록 가능 레이어
  * 각 컨테이너가 따로 소유
  * 컨테이너와 같은 생애주기
  * 사용처
    * 새 파일을 만들때 사용.
    * 기존 이미지 레이어에 있는 파일 수정 ->기록 중 복사 라는 방법 사용하여 수정. 수정된 파일은 해당 컨테이너의 기록 가능 레이어에만 존재

## 6.2 도커 볼륨을 사용하는 컨테이너 실행하기
* 도커 볼륨
  * 도커에서 스토리지를 다루는 단위 ex) 컨테이너를 위한 USB 메모리
  * 컨테이너와 독립적으로 존재. 별도의 생애주기를 갖는다. 
  * 컨테이너에 연결할 수 있다. 
    * 볼륨을 생성해 애플리케이션 컨테이너에 연결하면 컨테이너 파일 시스템의 한 디렉터리가 된다. 
    * 이 볼륨을 새로운 컨테이너에 연결하면 데이터가 그대로 유지
  * 컨테이너가 같은 볼륨을 공유할 수 있다. 
  * 사용처
    * 컨테이너 간 파일 공유보다는 업데이트 간 상태를 보존하기 위한 용도로 사용해야한다. 
  * 컨테이너와 스토리지의 생애주기를 분리하면서도 도커를 사용하는 방식 그대로 스토리지를 다룰 수 있다.
    * 호스트 컴퓨터상에 존재하지만 컨테이너와 분리

## 6.3 파일 시스템 마운트를 사용하는 컨테이너 실행하기
* 바인드 마운트
  * 호스트의 스토리지를 컨테이너에 좀더 직접적으로 연결할 수 있는 수단
  * 호스트 컴퓨터 파일 시스템의 디렉터리를 컨테이너 파일 시스템의 디렉터리로 만든다. 
  * 호스트 컴퓨터의 파일 시스템을 명시적으로 지정해 컨테이너 데이터로 쓸 수 있다.
  * 양방향 동작
    * 컨테이너에서 만든 파일을 호스트 컴퓨터에서 수정할 수 있다. 
    * 호스트에서 만든 파일도 컨테이너에서 수정
  * 권한 상승 필요

## 6.4 파일 시스템 마운트의 한계점
* 기존 디렉터리가 있는 경로에 바인드 마운트를 적용하면 기존 디렉터리는 대체되 나타나지 않는다. 
* 호스트 컴퓨터의 파일 하나를 컨테이너에 이미 존재하는 디렉터리로 마운트하면 디렉터리의 파일이 합쳐져 이미지에서 온 파일과 호스트에서 마운트된 파일이 합쳐져서 나타난다.
* 분산 파일 시스템을 컨테이너에 바이드 마운트하면 일부 기능이 안된다. 

## 6.5 컨테이너 파일 시스템은 어떻게 만들어지는가
* 유니언 파일 시스템 : 도커가 다양한 출처로부터 모아 만든 단일 가상 디스크
  * 컨테이너는 유니언 파일 시스템을 통해 물리적 위치가 서로 다른 파일과 디렉터리에 마치 단일 디스크를 사용하듯 접근할 수 있다. 
* 컨테이너의 스토리지를 구성할 때 고려해야 할 점
  * 기록 가능 레이어 : 단기 저장에 적합 ex) 데이터 캐싱
  * 로컬 바인드 마운트 : 호스트 컴퓨터와 컨테이너 간 데이터 공유
  * 분산 바인드 마운트 : 네트워크 스토리지와 컨테이너 간 데이터 공유. 읽기 전용으로 설정 파일 전달하거나 공유 캐시로 활용
  * 볼륨 마운트 : 컨테이너와 도커 객체인 볼륨 간에 데이터 공유. 데이터 영구적 저장
  * 이미지 레이어 : 컨테이너의 초기 파일 시스템 구성
