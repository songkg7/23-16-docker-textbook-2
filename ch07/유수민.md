# 7장. 도커 컴포즈로 분산 애플리케이션 실행하기

## 7.1 도커 컴포즈 파일의 구조
- dockerfile 스크립트 : 분산 애플리케이션 기준으로 보면, 애플리케이션의 한 부분을 패키징하는 수단일
- 도커 컴포즈 파일 : 모든 컴포넌트가 실행 중일때 어떤 상태여야 하는지를 기술하는 파일
    - 도커 컴포즈가 컨테이너, 네트워크, 볼륨 등 필요한 모든 도커 객체를 만들도록 도커 API 명령을 내린다. 
- version : 파일에 사용된 도커 컴포즈 파일 형식의 버전
- services : 애플리케이션을 구성하는 모든 컴포넌트를 열거하는 부분. 하나의 서비스를 같은 이미지로 여러 컨테이너에서 실행할 수 있다.
  - 속성이 기술된다. docker container run 명령의 옵션과 그 지정값의 쌍 형태
  - image : 실행할 이미지를 지정하는 필드
  - ports : 공개할 포트에 대한 정보
  - networks : 컨테이너가 접속할 도커 네트워크를 정의하는 필드
  - 서비스 이름은 DNS 네임으로도 쓰인다. 
- networks : 서비스 컨테이너가 연결될 모든 도커 네트워크를 열거하는 부분

## 7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 애플리케이션 실행하기
- 도커 컴포즈는 컨테이너를 관리하는 별도의 명령이지만 내부적으로는 마찬가지로 도커 API를 사용한다. 
  - 도커 컴포즈로 실행한 컨테이너라도 똑같이 도커 명령행으로 관리할 수 있다. 
  - 도커 컴포즈는 YAML 파일에 정의된 애플리케이션 정의에 의존하는 클라이언트 측에서 동작하는 도구

## 7.3 도커 컨테이너 간의 통신
- 컨테이너는 도커 엔진으로부터 부여받은 자신만의 가상 IP 주소를 가지며 모두 같은 도커 네트워크로 연결돼 이 IP 주소를 통해 서로 통신 가능
- 애플리케이션 생애주기동안에 컨테이너가 교체되면 IP 주소도 변경되고 이때 문제가 없도록 DNS를 이용해 서비스 디스커버리 기능을 제공한다. 
  - DNS : IP 주소를 도메인과 연결하는 기능을 제공하는 시스템
- 도커에도 DNS 서비스 내장됨
  - 컨테이너에서 실행 중인 애플리케이션도 다른 구성 요소에 접근하기 위해 이 DNS 서비스를 사용한다. 
- 하나의 도메인에 대해 여러개의 IP 주소가 나올 수 있다. 
  - 도커 컴포즈는 이를 이용해 간단한 로드 밸런싱을 구현할 수 있다. 

## 7.4 도커 컴포즈로 애플리케이션 설정값 지정하기
- environment : 컨테이너 안에서 사용될 환경 변수 값 정의
- secrets : 실행시 컨테이너 내부의 파일에 기록될 비밀값 정의
  - 주로 클러스터 환경에서 쿠버네티스나 도커 스웜 같은 컨테이너 플랫폼을 통해 제공된다.
- 패키징된 애플리케이션과 설정값을 분리할 수 있다.( 도커의 핵심적인 장점 )

## 7.5 도커 컴포즈도 만능은 아니다. 
- 도커 컴포즈에는 애플리케이션이 지속적으로 정의된 상태를 유지하도록 하는 기능이 없다. 
- 고가용성, 로드밸런싱, 이중화 같은 기능은 갖추지 못한다. 
- 애플리케이션의 모든 구성 요소가 각자의 dockerfile 스크립트와 컴포즈 파일을 갖게 되고, 항상 동일한 도구로 애플리케이션을 배포하고 관리할 수 있다. 
