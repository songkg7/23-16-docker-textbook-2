---
marp: true
---

# Dockerfile vs. docker-compose.yml
```
Dockerfile: 컴포넌트에 대응됨
docker-compose.yml: 어플리케이션 전체에 대응됨
```
분산 어플리케이션은 여러 개의 컴포넌트(ex. API서버, DB, 웹프론트 등)로 구성된다. 
각 컴포넌트를 패키징하는 수단이 Dockerfile. 
모든 컴포넌트가 실행중일 때의 상태(네트워크, 컨테이너, 볼륨 등과 관련된 옵션 모음)를 기술한 것이 docker-compose.yml

Q. 각 컨테이너를 도커 명령어로 실행하지 않는 이유는?
각 컴포넌트를 위한 각종 옵션을 지정하기도 번거로울 뿐더러 오류를 발생시키기 좋음.

---

# 도커 컴포즈 파일의 구조
* version
도커 컴포즈 파일 형식의 버전
* services
어플리케이션을 구성하는 모든 컴포넌트를 열거하는 부분
이 때, 컴포넌트는 컨테이너가 아닌 서비스를 단위로 삼는다. (하나의 서비스를 패키지한 하나의 이미지를 여러 컨테이너에서 실행할 수 있기 때문)
* networks
서비스 컨테이너가 연결될 모든 도커 네트워크
* environment
컨테이너 안에서 사용될 환경변수 값
* secrets
실행 시 컨테이너 내부의 파일에 기록될 비밀값

---

# 명령어 모음
`docker-compose up` 
현재 디렉토리에서 docker-compose.yml을 찾아서 어플리케이션 정의를 읽어들인 뒤 컨테이너들을 실행함.
`docker-compose up --detach --scale {서비스명}={갯수}`
detach: 분리 모드
scale: 컨테이너 수 늘리기
`docker-compose logs --tail=1 {서비스명}`
서비스가 실행되는 모든 컨테이너의 마지막 로그를 출력하라

---
### 도커 컨테이너 간 통신
`nslookup {도메인}`
도커에 내장된 DNS 서비스: 컨테이너 이름(도메인)을 조회하면 해당 컨테이너의 IP 주소를 찾아줌
컨테이너가 교체되더라도, DNS 조회를 함으로써, 정의해둔 컨테이너 이름으로 IP를 조회하여 접근할 수 있음.
도메인에 여러 개의 IP주소가 대응될 수 있음 --> 이를 활용하여 로드밸런싱도 가능.

### 도커 컴포즈의 한계
도커 컴포즈의 역할은 어플리케이션 실행까지일 뿐, 컨테이너 내에서 오류 발생 시의 대응은 컨테이너 플랫폼(도커 컴포즈, 도커 스웜, 쿠버네티스)의 역할.
### 도커 컴포즈를 활용하기 적합한 상황
로컬 end-to-end 테스트, 배포 후 CI/CD 및 테스트
운영환경에서는 컨테이너 플랫폼을 활용 (어플리케이션 정의 시엔 컴포즈 파일 포맷 씀)