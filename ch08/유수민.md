# 8장. 헬스 체크와 디펜던시 체크로 애플리케이션의 신뢰성 확보하기

## 8.1 헬스 체크를 지원하는 도커 이미지 빌드하기
도커는 애플리케이션의 상태가 실제로 정상인지 확인을 Dockerfile 스크립트에 로직을 포함함으로써 해당 로직으로 확인할 수 있다. 
- 헬스체크로 이상 상태를 보이는 컨테이너 발생을 통보만 하고, 컨테이너를 재시작하거나 다른 컨테이너로 교체하지 않는다.(상황이 나아질 것이라는 보장이 없으므로)

## 8.2 디펜던시 체크가 적용된 컨테이너 실행하기
의존관계를 만족하는지 점검하는 디펜던시 체크 기능도 도커 이미지에 추가할 수 있다. 
- 디펜던시 체크 : 애플리케이션 실행전에 필요한 요구 사항을 확인하는 기능
- 디펜던시 체크 후 애플리케이션 실행

## 8.3 애플리케이션 체크를 위한 커스텀 유틸리티 만들기
- curl : 웹 애플리케이션이나 API 테스트하는데 유용하나 보안정책상 이미지에 포함시킬 수 없다. 
- 실제 애플리케이션 체크에는 애플리케이션과 같은 언어로 구현된 별도의 커스텀 유틸리티를 사용하는 것이 낫다.
- 별도의 커스텀 유틸리티의 장점
  - 애플리케이션과 같은 도구를 사용하여 이미지에 추가적인 소프트웨어를 포함시킬 필요가 없다. 
  - 까다로운 복잡한 체크 로직 적용 가능 ex.재시도횟수, 분기
  - 대상 Url을 여러곳에 반복 정의하거나 수정에서 누락시키는 일 방지
  - 애플리케이션과 같은 라이브러리 환경에서 컨테이너 실행 전 확인이 필요한 모든 사항 검증 가능

## 8.4 도커 컴포즈에 헬스 체크와 디펜던시 체크 정의하기
- interval : 헬스 체크 실시 간격
- timeout : 응답을 받지 못하면 실패로 간주하는 제한 시간
- retries : 컨테이너 상태를 이상으로 간주할 때까지 필요한 연속 실패 획수
- start_period : 컨테이너 실행 후 헬스 체크를 실시하는 시간 간격

## 8.5 헬스 체크와 디펜던시 체크로 복원력 있는 애플리케이션을 만들 수 있는 이유
- 디펜던시 체크와 헬스 체크를 도입하면 처음부터 플랫폼이 실행 순서를 보장하게 할 필요가 없다. 
- 헬스 체크는 주기적으로 자주 실행되므로 시스템에 부하를 주는 내용이어서는 안된다.
  - 자원을 너무 많이 소모하지 않으면서 애플리케이션이 실질적으로 동작 중인지 검증할 수 있는 핵심적인 부분을 테스트해야한다. 
- 디펜던시 체크는 애플리케이션 시작 시에만 실행되어 테스트에 소모되는 리소스에 너무 크게 신경 쓸 필요없다. 
  - 단, 테스트 대상이 빠짐없이 정확하도록 주의해야 한다. 