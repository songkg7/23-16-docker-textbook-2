---
marp: true
---

# 12장. 컨테이너 오케스트레이션: 도커 스웜과 쿠버네티스

---

## 12.1 컨테이너 오케스트레이션 도구란?

단일 호스트 환경에서는 호스트 한 대가 고장 -> 전체 앱 중단
서비스 운영을 위한 시스템은 고가용성을 요구 -> 이 때문에 오케스트레이션이 필요

오케스트레이션 도구 : 기본적으로 클러스터(cluster)를 구성하는 여러 대의 호스틑 컴퓨터
- 하는 일 1. 컨테이너 관리
- 하는 일 2. 서비스를 제공하기 위한 작업을 여러 컴퓨터에 분배
- 하는 일 3. 네트워크 트래픽 부하를 고르게 분산
- 하는 일 4. 상태가 불량한 컨테이너를 새 컨테이너로 교체하는 일 담당

---

![width:600px](/ch12/wonjong/12_1.jpeg)

---

오케스트레이션 도구가 가진 기능
1. 클러스터에 배포된 앱에 대한 모든 정보가 담긴 분산 DB
2. 어떤 컨테이너를 어떤 호스트에서 실행할지 배정하는 스케줄러
3. 클러스터를 구성하는 호스트 간 주기적으로 연락 신호를 주고 받는 시스템

오케스트레이션 도구를 보면 서버가 나타나 있지 않음
- 오케스트레이션 도구가 각 서버, 네트워크, 스토리지 장치의 세부 사항을 가려 주기 때문
- 클러스터가 마치 하나의 대상인 것처럼 명령행 도구와 API를 통해 명령을 보내고 쿼리를 요청해 사용

---

## 12.2 도커 스웜으로 클러스터 만들기

도커 스웜은 도커 엔진에 포함이 되어 있어서 별도의 설치가 필요 없음

docker swarm init

클러스터에 속한 컴퓨터는 매니저와 워커라는 두 가지 역할 중 하나를 맡음
- 매니저는 클러스터를 관리하는 역할을 직접 수행
- 워커는 매니저의 스케줄링에 따라 컨테이너를 실행하고, 그 상태를 주기적으로 매니저에 보고하는 역할

---

## 12.3 도커 스웜 서비스로 앱 실행하기

도커 스웜 환경에서는 컨테이너를 직접 실행할 필요가 X
- 서비스를 배포하면 스웜이 대신 컨테이너를 실행
- 서비스는 컨테이너를 추상화한 개념

서비스는 컨테이너와 같은 정보로 정의
- 차이점이 있다면, 서비스는 여러 개의 레플리카를 가질 수 있음

컨테이너 관리를 스웜이 대신해 주니 컨테이너를 직접 다룰 일은 많지 않음

서비스를 업데이트하면 점진적 롤링 업데이트 방식으로 새로운 버전의 어플리케이션이 배치

---

## 12.4 클러스터 환경에서 네트워크 트래픽 관리하기

컨테이너에서 실행되는 앱의 입장에서 스웜 모드의 네트워크는 표준 TCP/IP 방식

컴포넌트는 도메인 이름으로 서로를 식별
- 도커 DNS 서버가 도메인 이름을 조회해 IP 주소를 알려주면 이 IP 주소로 트래픽을 전달
- 트래픽은 컨테이너에 전달되고 컨테이너가 응답을 보냄

스웜 모드에서는 오버레이 네트워크라는 도커 네트워크 사용 가능
- 오버레이 네트워크는 클러스터에 속한 모든 노드를 연결하는 가상 네트워크
- 오버레이 네트워크는 서비스를 가리키는 가상 IP 주소를 반환

---

서비스는 VIP 네트워킹을 사용하기 때문에 레플리카가 아무리 많아도 IP 주소는 하나

VIP 네트워크는 네트워크 트래픽을 고르게 분배하는 로드 밸런싱에 훨씬 더 유리
- 서비스의 스케일링 규모와 상관없이 DNS 조회 결과에는 IP 주소가 하나만 조회
- 클라이언트가 이 IP 주소로 요청을 보내면, 네트워크 계층에서 이 IP 주소의 종착점이 여러 곳임을 파악하고 그 중 하나를 결정해 줌

도커 스웜은 서비스 접근에 대한 신뢰성을 높이고 부하를 잘 분산시키기 위해 VIP 네트워크 사용

인그레스 네트워킹 : 모든 노드가 같은 포트를 감시하며 외부 트래픽을 받고, 이렇게 노드에 도달한 트래픽에 대한 내부적인 로드 밸런싱을 도커가 맡음

---

## 12.5 도커 스웜과 쿠버네티스 중 무엇을 사용할까?

시작은 도커 스웜, 결론은 쿠버네티스