---
marp: true
---
# 12장. 컨테이너 오케스트레이션: 도커 스웜과 쿠버네티스
* 오케스트레이션 : 여러 대의 도커 호스트와 컨테이너를 관리해 주는 관리 레이어
    * 주요 도구 : 도커 스웜, 쿠버네티스
* 도커 스웜이나 쿠버네티스 같은 오케스트레이션 도구를
  1) 프로비저닝 및 배포
  2) 구성 및 일정 조정
  3) 리소스 할당
  4) 컨테이너 가용성
  5) 컨테이너 스케일링 또는 제거
  6) 로드 밸런싱 및 트래픽 라우팅
  7) 컨테이너 모니터링
  8) 실행된 컨테이너를 기반으로 애플리케이션 설정
  9) 컨테이너 간 보안유지
---
## 컨테이너 오케스트레이션 도구
* 오케스트레이션 도구 : 클러스터를 구성하는 여러 대의 호스트 컴퓨터
* 필요 이유 : 고가용성 - 컨테이너를 관리하고, 서비스를 제공하기 위한 작업을 여러 컴퓨터에 
분배하며, 네트워크 트래픽 부하를 고르게 분산시키고, 상태가 불량한 컨테이너를 새 컨테이너로 
교체하는 일을 담당
* 구성 
    1) 클러스터에 배포된 애플리케이션에 모든 정보가 담긴 분산 데이터베이스
    2) 스케줄러 : 어떤 컨테이너를 어떤 호스트에서 실행할지 배정
    3) 클러스터를 구성하는 호스트 간에 주기적으로 연락 신호를 주고 받는 시스템
* 복잡한 컨테이너 관리는 모두 오케스트레이션 도구가 대신
* 틀러스터가 마치 하나의 대상인 것처럼 명령해 도구와 API를 통해 명령을 보내고 쿼리를 요청해 
사용한다. - 오케스트레이션 도구가 각 서버, 네트워크, 스토리지 장치의 세부사항을 가려준다. 
---

## 도커 스웜으로 크러스터 만들기
* 도커 스웜은 도커 엔진에 포함돼 있어 별도의 설치가 필요 없으며 도커 엔진을 스웜 모드로 
전환해 클러스터를 초기화하면 된다.
* 도커 스웜이 쿠버네티스보다 나은 점 중 하나는 클러스터를 구성하고 관리하는 작업이 단순하다는 
점
---
## 도커 스웜 서비스로 애플리케이션 실행하기
* 도커 스웜 환경에서는 컨테이너를 직접 실행할 필요가 없습니다. 서비스를 배포하면 스웜이 대신 
컨테이너를 실행 - 서비스 : 컨테이너를 추상화한 개념
* 서비스는 컨테이너와 같은 정보로 정의. 사용되는 이미지, 환경 변수와 값, 공개되는 포트와 
같은 정보. 
* 서비스 : 여러개의 레플리카를 가질수 있다. ( 컨테이너와의 차이점 ) - 서비스를 구성하는 
컨테이너를 레플리카
* 서비스 전체의 구성 정보는 클러스터에 저장돼 있으므로, 포맷 파라미터 없이 service 
inspect 명령을 입력하면 확인할 수 있다
* 도커 컴포즈가 도커 스웜가 가장 큰 다른 점은 애플리케이션 정의를 저장할 공간을 갖지 않는다는
것
___
* 모든 컨테이너 오케스트레이션 도구는 애플리케이션을 업데이터할 때 애플리케이션을 중단시키지 
않고 점진적으로 컨테이너를 교채하는 롤링 업데이트 방식을 사용
    1)  자동화된 롤링방식은 자기 수복형 애플리케이션의 또 다른 기능적 축을 담당.
    2) 새로 투입된 신 버전 컨테이너에서 문제가 발생하면 업데이트가 자동으로 중단돼 전체 
애플리케이션으로 문제가 번지지 않도록 막는다.
    3) 스웜의 데이터베이스는 이전 버전의 서비스 정의 내용이 남아 있으므로 명령 한 번으로 
이전 버전으로 롤백할 수 있다.
---
## 클러스터 환경에서 네트워크 트래픽 관리하기
* 오버레이 네트워크 : 클러스터에 속한 모든 노드를 연결하는 가상 네트워크
* 오버레이 네트워크에 연결된 서비스는 서비스 이름을 도메인 네임 삼아 다른 서비스와 통신할 수 
있다.
* 오버레이 네트워크는 서로 독립적이므로 서로 다른 네트워크에 속한 서비스는 통신이 불가능
    * 같은 애플리케이션에 속하는 서비스는 오버레이 네트워크를 통해 통신이 가능
* 오버레이 네트워크와 일반적인 네트워크의 차이점은 오버레이 네트워크에서는 서비스를 가리키는 
가상 IP 주소를 반환한다는 점
---

## 도커 스웜과 쿠버네티스 중 무엇을 사용할까?
* 도커 스웜은 상대적으로 간단한 컨테이너 오케스트레이션 도구로 설계됨
* 쿠버네티스는 주요 클라우드 서비스에서 매니지드 서비스 형태로 제공
* 쿠버네티스는 확장성이 뛰어나다.
* 클러스터 생성은 애플리케이션 배포보다는 빈도가 적지만 반복적으로 해야 하는 업무일 때는 도커 
스웜을 사용하는 편이 훨씬 간편

---

# 도커 스웜에서 사용하는 용어
* 스웜 swarm: 직역하면 떼, 군중이라는 뜻 도커 1.12버전에서 스웜이 스웜 모드로 바뀌었지만 그냥 스웜이라고도 하는듯 합니다.
  스웜 클러스터 자체도 스웜이라고 합니다. (스웜을 만들다. 스웜에 가입하다. = 클러스터를 만들다. 클러스터에 가입하다)
* 노드 node: 스웜 클러스터에 속한 도커 서버의 단위입니다. 보통 한 서버에 하나의 도커데몬만 실행하므로 서버가 곧 노드라고
  이해하면 됩니다. 매니저 노드와 워커 노드가 있습니다.
* 매니저노드 manager node: 스웜 클러스터 상태를 관리하는 노드입니다. 매니저 노드는 곧 워커노드가 될 수 있고 스웜 명령어는
  매니저 노드에서만 실행됩니다.
* 워커노드 worker node: 매니저 노드의 명령을 받아 컨테이너를 생성하고 상태를 체크하는 노드입니다.
* 서비스service: 기본적인 배포 단위입니다. 하나의 서비스는 하나의 이미지를 기반으로 생성하고 동일한 컨테이너를 한개 이상
  실행할 수 있습니다.
* 테스크task: 컨테이너 배포 단위입니다. 하나의 서비스는 여러개의 테스크를 실행할 수 있고 각각의 테스크가 컨테이너를 관리합니다.