---
marp: true
---

# 16장. 어디서든 실행할 수 있는 도커 이미지 만들기
---
## 다중 아키텍처 이미지가 중요한 이유
이미지를 내려받는 과정에는 이미지를 구성하는
레이어를 내려받는 것 외에 이미지를 곧바로 사용할
수 있도록 레이어의 압축을 푸는 최적화 과정도
포함된다.
-> 최적화 과정은 이미지의 아키텍처와 현재
컴퓨터의 아키텍처(도커 엔진의 아키텍처)가
일치해야만 한다.

---

## 다중 아키텍처 이미지를 만들기 위한
Dockerfile 스크립트
다중 아키텍처 이미지를 만들 수 있는 방법
1) 멀티 스테이지 Dockerfile 스크립트를 이요해
   컨테이너에서 소스 코드를 빌드하고 패키징하는 방법
    * Dockerfile 스크립트 하나로 다른
      아키텍처의 컴퓨터에서 이미지를 빌드하면 해당
      아키텍처의 미지를 만들 수 있다.
    * 모든 대상 운영체제에서 공통적으로 사용할
      수 있는 명령어만 사용해야한다.
2) Dockerfile 스크립트를 아키텍처별로 맞춤으로
   작성할 수 있다.
   Dockerfile 가짓수가 늘어나지만 대상
   타키텍처마다 이미지에 원하는 대로 변화를 줄
   수 있다.

---
* 매니페스트 : 여러개의 변종 이미지를 하나의
  미이지 태그로 묶는 메타데이터. 매니페스트에는
  이미지 변종의 목록이 담기는데, 이들 이미지가 먼저
  레지스트리에 푸시된 상태여야 한다.
* 매니페스트 리스트 : 두개 이상의 이미지를 하나의
  이미지 태그로 묶어 주는 역할
* 이미지, 매니페스트, 매니페스트 리스트의 관계
    * 이미지 : 컨테이너의 파일 시스템 내용,
      대상 운영체제 및 아키텍처 정보, 이미지 태그
      정보를 포함한다. 로컬에 위치하든 레지스트리에
      위치하든 모든 이미지는 이들 정보를 갖고
      있다.
    * 매니페스트 : 대상 운영체제, 아키텍처 등
      이미지에 대한 메타데이터만 들어있다.
    * 매니페스트 리스트:  같은 이미지 태그로
      묶이는 이미지들의 매니페스트를 모은 것이다.

---
Buildx
* docker build 명령의 확장판. 최적화된 빌드
  엔진이 적용돼 빌드 성능이 뛰어나다.
* 빌더로 사용 가능한 도커 컨텍스트를 찾아
  컨텍스트가 가리키는 노드의 플랫폼 정보를 스스로
  확인할 수도 있을 만큼 유연성이 뛰어나다.
* Buildx 가 이미지 빌드, 푸시, 매니페스트
  생성과 푸시까지 다 알아서 해준다.  
