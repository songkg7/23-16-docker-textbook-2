# 17. 도커 이미지: 최적화하기: 보안, 용량 속도
- 여러가지 아키텍처를 지원하면서 운영비가 싼 ARM 이나 개발환경(MAC, WINDOWS)에 필요한 환경 지원 바로 가능하다.

## 17.1 이미지 최적화
- `docker system df`
- 이미지와 컨테이너 등이 점유하고 있는 메모리 확인 가능하다. 
- `docker system prune`
- 레이어 빌드 캐시가 비워진다.
- 애플리케이션 실행에 필요하지 않은 파일은 이미지에 복사하지 않는다.
- .dockerignore 파일에 불필요한 디렉터리나 파일 목록을 기재하면 빌드 컨텍스트에서 파일 제외가능하다.

## 17.2 좋은 기반 이미지
- 이미지의 크기 == 애플리케이션 보안 (curl)
- 가장 큰 open jdk 이미지 sdk 다 들어가 있다 -> sdk를 이용해서 자바 코드작성후 멋대로 실행할 수 있다.
- 이미지 스캐너가 필요하다

## 17.3 이미지 레이어수 && 이미지 크기 최소한
- 설치 + 패키지 캐시 삭제 + 하나의 RUN 인스트럭션으로 묶기
- 다운로드 + 압축 해제 + 삭제 까지도 하나로 묶어버리기

## 17.4 멀티스테이지 빌드 업그레이드
- `FROM base AS download`
- `FROM base AS expand`
- 이렇게 분리시키면 jenkins에서 cache를 사용할때 바로 시간을 낭비하지않고 이미지를 가져온다.

## 17.5 최적화가 중요한 이유
- 골든 이미지
- 멀티 스테이지 빌드
- 레이어 크기 최소한
- 자주 수정되는 인스트럭션 뒤에 배치
